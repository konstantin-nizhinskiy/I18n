/*
name: nks-i18n
version: 0.9.0
author: Konstantin Nizhinskiy
date: 2016-06-29 11:06:10 

*/
!function(a,b){"function"==typeof define&&define.amd?define("i18n",[],function(){return a.i18n=b()}):a.i18n=b()}(this,function(){var a=function(){this.setProperty({local:"UA",localDefault:"UA",versionJson:+new Date})},b="UA",c="UA",d={},e={};a.prototype.changeLocal=function(a){var b=[],c=this;for(var d in e)e[d][a]!==!0&&b.push(d);if(b.length>0){var f=b.length,h=function(){f--,0===f&&c.trigger("changeLocal",a)};g(a),b.forEach(function(a){c.load(a,h)})}else g(a),this.trigger("changeLocal",a)};var f={};a.prototype.on=function(a,b){"undefined"==typeof f[a]&&(f[a]={callback:[],callbackOnce:[]}),f[a].callback.push(b)},a.prototype.once=function(a,b){"undefined"==typeof f[a]&&(f[a]={callback:[],callbackOnce:[]}),f[a].callbackOnce.push(b)},a.prototype.off=function(a,b){var c;if("function"==typeof b){if(f[a].callback&&f[a].callback.length>0){c=[];for(var d=0;d<f[a].callback.length;d++)"function"==typeof f[a].callback[d]&&f[a].callback[d]!==b&&c.push(f[a].callback[d]);f[a].callback=c}if(f[a].callbackOnce&&f[a].callbackOnce.length>0){c=[];for(var d=0;d<f[a].callbackOnce.length;d++)"function"==typeof f[a].callbackOnce[d]&&f[a].callbackOnce[d]!==b&&c.push(f[a].callbackOnce[d]);f[a].callbackOnce=c}}else delete f[a]},a.prototype.trigger=function(a){if(f[a]){var b=[];for(var c in arguments)0!=c&&b.push(arguments[c]);if(f[a].callback&&f[a].callback.length>0)for(var d=0;d<f[a].callback.length;d++)"function"==typeof f[a].callback[d]&&f[a].callback[d].apply(this,b);if(f[a].callbackOnce&&f[a].callbackOnce.length>0){for(var d=0;d<f[a].callbackOnce.length;d++)"function"==typeof f[a].callbackOnce[d]&&f[a].callbackOnce[d].apply(this,b);f[a].callbackOnce=[]}}},a.prototype.get=function(a,b){var e;if(d[this.getLocal()]&&d[this.getLocal()][a]){if(e=d[this.getLocal()][a],"object"==typeof b)for(var f in b)e=e.replace(new RegExp("{{[ ]{0,}"+f+"[ ]{0,}}}","g"),b[f]);return e}if(this.trigger("error","error:translation:key",a,this.getLocal()),this.trigger("error:translation:key",a,this.getLocal()),c&&d[c]&&d[c][a]){if(e=d[c][a],"object"==typeof b)for(var f in b)e=e.replace(new RegExp("{{[ ]{0,}"+f+"[ ]{0,}}}","g"),b[f]);return e}return a},a.prototype.getLocal=function(){return b},a.prototype.load=function(a,b){if("undefined"==typeof e[a]&&(e[a]={}),"undefined"==typeof e[a][this.getLocal()]){var c=new XMLHttpRequest,f=this;c.open("GET",a+"."+this.getLocal().toLowerCase()+".json?"+this._versionJson,!0),c.send(),c.onreadystatechange=function(){if(4==c.readyState)if(200!=c.status)f.trigger("error","error:load",c.statusText,c.status,c),f.trigger("error:load",c.statusText,c.status,c),"function"==typeof b&&b();else{var g=JSON.parse(c.responseText);if(e[a][f.getLocal()]=!0,"undefined"==typeof d[f.getLocal()])d[f.getLocal()]=g;else for(var h in g)d[f.getLocal()][h]||(d[f.getLocal()][h]=g[h]);f.trigger("load",a,e[a][f.getLocal()]),"function"==typeof b&&b()}}}else"function"==typeof b&&b()};var g=function(a){b=a};return a.prototype.setProperty=function(a){a.local&&(b=a.local),a.localDefault&&(c=a.localDefault),a.versionJson&&(this._versionJson=a.versionJson)},new a});